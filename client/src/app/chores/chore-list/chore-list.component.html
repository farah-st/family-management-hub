<div class="mx-auto max-w-3xl p-4">
  <header class="chore-header">
    <h1 class="text-2xl font-semibold">Chores</h1>

    <a
      routerLink="new"
      class="px-4 py-1.5 rounded-lg bg-black text-white text-sm leading-none hover:opacity-80 transition"
    >
      + New
    </a>
  </header>

  <!-- Totals per family member -->
  <ng-container *ngIf="totals$ | async as totals">
    <section class="totals-box mb-4">
      <h2>What I owe for chores</h2>
      <div class="grid grid-cols-1 gap-2">
        <div class="flex items-center justify-between">
          <span>
            Mom:
            {{ totals.mom | currency:'USD':'symbol':'1.2-2' }}
          </span>
          <button
            type="button"
            class="paid-total-btn"
            (click)="payMember('mom')"
            [disabled]="totals.mom === 0"
          >
            Paid
          </button>
        </div>

        <div class="flex items-center justify-between">
          <span>
            Dad:
            {{ totals.dad | currency:'USD':'symbol':'1.2-2' }}
          </span>
          <button
            type="button"
            class="paid-total-btn"
            (click)="payMember('dad')"
            [disabled]="totals.dad === 0"
          >
            Paid
          </button>
        </div>

        <div class="flex items-center justify-between">
          <span>
            Daughter:
            {{ totals.daughter | currency:'USD':'symbol':'1.2-2' }}
          </span>
          <button
            type="button"
            class="paid-total-btn"
            (click)="payMember('daughter')"
            [disabled]="totals.daughter === 0"
          >
            Paid
          </button>
        </div>

        <div class="flex items-center justify-between">
          <span>
            Son:
            {{ totals.son | currency:'USD':'symbol':'1.2-2' }}
          </span>
          <button
            type="button"
            class="paid-total-btn"
            (click)="payMember('son')"
            [disabled]="totals.son === 0"
          >
            Paid
          </button>
        </div>
      </div>
    </section>
  </ng-container>

  <!-- Main list of OPEN chores -->
  <ng-container *ngIf="open$ | async as chores; else loading">
    <ng-container *ngIf="chores.length; else empty">
      <ul class="grid gap-2">
        <li
          *ngFor="let c of chores; trackBy: trackById"
          class="chore-item"
        >
          <!-- Done button: opens the member picker -->
          <button
            type="button"
            (click)="startComplete(c)"
            class="done-btn"
          >
            Done
          </button>

          <!-- Main content -->
          <div class="flex-1 min-w-0">
            <!-- Title + due date + priority + due status -->
            <div class="flex items-center gap-2 flex-wrap">
              <a [routerLink]="[c.id]" class="chore-title">
                {{ c.title }}
              </a>

              <span
                *ngIf="firstDueDate(c) as due"
                class="ml-2 text-xs text-slate-500"
              >
                Due {{ due | date: 'MMM d' }}
              </span>

              <span
                *ngIf="isOverdue(c)"
                class="due-pill due-pill--overdue"
              >
                Overdue
              </span>

              <span
                *ngIf="!isOverdue(c) && isDueToday(c)"
                class="due-pill due-pill--today"
              >
                Due today
              </span>

              <span class="priority-pill">
                {{ c.priority }}
              </span>
            </div>

            <!-- Assignee + reward row -->
            <div class="mt-1 text-xs text-slate-600 flex flex-wrap gap-2">
              <!-- Assignee -->
              <ng-container *ngIf="c.assignedTo as a">
                <span *ngIf="a.name" class="chore-assignee">
                  Assigned to: {{ a.name }}
                  <span *ngIf="a.role">({{ a.role }})</span>
                </span>
              </ng-container>

              <!-- Reward -->
              <span
                *ngIf="c.rewardAmount && c.rewardAmount > 0"
                class="chore-reward"
              >
                Reward:
                {{ c.rewardAmount | currency : (c.rewardCurrency || 'USD') : 'code' : '1.2-2' }}
              </span>
            </div>

            <!-- Member picker appears when selectingForId matches -->
            <div
              *ngIf="selectingForId === c.id"
              class="member-picker mt-2 flex flex-wrap items-center gap-2 text-xs"
            >
              <span class="member-picker-label">Who completed this chore?</span>
              <button
                *ngFor="let m of members"
                type="button"
                class="member-btn"
                (click)="complete(c, m.id)"
              >
                {{ m.label }}
              </button>
            </div>
          </div>

          <!-- Right-side actions -->
          <div class="flex flex-col gap-1">
            <button
              type="button"
              class="delete-btn"
              (click)="remove(c)"
            >
              Delete
            </button>
          </div>
        </li>
      </ul>
    </ng-container>
  </ng-container>

  <ng-template #loading>
    <div class="loading-state">
      Loading choresâ€¦
    </div>
  </ng-template>

  <ng-template #empty>
    <div class="empty-state">
      <p class="mb-3">No chores yet.</p>
      <a routerLink="new">
        Create your first chore
      </a>
    </div>
  </ng-template>
</div>


